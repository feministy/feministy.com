<!DOCTYPE html>
<html>
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>feministy.com - Using the Ravelry API to build a website</title>
      <meta name="viewport" content="width=device-width">
      <link rel="stylesheet" href="/stylesheets/bootstrap.css">
      <link rel="stylesheet" href="/stylesheets/bootstrap-responsive.css">
      <link rel="stylesheet" href="/stylesheets/main.css">
      <style> body { padding: 80px 0 80px 0; } </style>
    </head>
    <body>
      <div class="fixed-top-menu-pills">
        <ul class="nav nav-pills">
  <li class="active"><a href="/">Home</a></li>
  <li><a href="/shop">Shop</a></li>
  <li><a href="/extras/teaching">Teaching</a></li>
  <li><a href="/extras/wholesale">Wholesale</a></li>
  <li><a href="/extras/errata">Errata</a></li>
  <li><a href="http://www.ravelry.com/groups/traveling-woman" target="_blank">Ravelry</a></li>
</ul>

      </div>
      <div class="container-fluid">
        <div class="row-fluid">
          <div class="span2">
            <!-- Nav menu -->
            <div class="page-header">
              <h4>feministy.com <br><small>home of knitwear designer Liz Abinante</small></h4>
            </div>
            <ul class="nav nav-list">
  <h5>Hello!</h5>
</ul>
<ul class="nav nav-list">
  <li class="nav-header">Resources and Info</li>
  <li><a href="/about/liz">About Liz</a></li>
  <li><a href="/blog/archives">Blog archives</a></li>
  <li><a href="/about/api">Using the Ravelry API to build a website</a></li>
  <li><a href="/extras/weaving">Weaving math for rigid heddle looms</a></li>
</ul>
<hr>
<h5>Patterns by Collection</h5>
<ul class="nav nav-list">
  <li class="nav-header">Collections</li>
  <li><a href="/collections/arch-shawls">Arch Shawls</a></li>
  <li><a href="/collections/great-cowl-kal-12">The Great Cowl KAL 2012</a></li>
  <li><a href="/collections/funke-socks">Funke Socks</a></li>
  <li><a href="/collections/traveling-woman">Traveling Woman</a></li>
  <li><a href="/collections/fairy-tales-saga">Fairy Tales Saga</a></li>
</ul>
<h5>Patterns by Category</h5>
<ul class="nav nav-list">
  <li class="nav-header">Shawls, Cowls, and Wraps</li>
  
    <li><a href="/volatile-magic-shawl">Volatile Magic Shawl</a></li>
  
    <li><a href="/wish-i-was-weaving-this-cowl">Wish I Was Weaving This Cowl</a></li>
  
    <li><a href="/cove-cowl">Cove Cowl</a></li>
  
    <li><a href="/voussoir-shawl">Voussoir Shawl</a></li>
  
    <li><a href="/babington-shawl">Babington Shawl</a></li>
  
    <li><a href="/squinch-shawl">Squinch Shawl</a></li>
  
    <li><a href="/like-honey-cowl">Like Honey Cowl</a></li>
  
    <li><a href="/lancet-shawl">Lancet Shawl</a></li>
  
    <li><a href="/blueberry-scowl">Blueberry Scowl</a></li>
  
    <li><a href="/triptych-shawl">Triptych Shawl</a></li>
  
    <li><a href="/perpetually-persistent-cowl">Perpetually Persistent Cowl</a></li>
  
    <li><a href="/weeble-wobble-cowl">Weeble Wobble Cowl</a></li>
  
    <li><a href="/flurries-cowl">Flurries Cowl</a></li>
  
    <li><a href="/ivory-tower-cowl">Ivory Tower Cowl</a></li>
  
    <li><a href="/ode-to-the-bay">Ode to the Bay</a></li>
  
    <li><a href="/squish-monster-cowl-of-awesomeness">Squish Monster Cowl of Awesomeness</a></li>
  
    <li><a href="/my-renaissance">My Renaissance</a></li>
  
    <li><a href="/roxanne-mystery-shawl">Roxanne Mystery Shawl</a></li>
  
    <li><a href="/lunas-shawl">Luna's Shawl</a></li>
  
    <li><a href="/traveling-cowl">Traveling Cowl</a></li>
  
    <li><a href="/citizen-shawl">Citizen Shawl</a></li>
  
    <li><a href="/a-very-good-cowl-indeed">A Very Good Cowl Indeed</a></li>
  
    <li><a href="/traveling-woman">Traveling Woman</a></li>
  
    <li><a href="/yvaine">Yvaine</a></li>
  
</ul>
<hr>
<ul class="nav nav-list">
  <li class="nav-header">Scarves</li>
  
    <li><a href="/double-leaf-saroyan">Double Leaf Saroyan</a></li>
  
    <li><a href="/one-million-eyelets">One Million Eye(let)s</a></li>
  
    <li><a href="/any-yarn-scarf">Any Yarn Scarf</a></li>
  
    <li><a href="/traveling-scarf-2">Traveling Scarf</a></li>
  
    <li><a href="/hatters-party-scarf">Hatter's Party Scarf</a></li>
  
    <li><a href="/saroyan">Saroyan</a></li>
  
    <li><a href="/objects-in-space">Objects in Space</a></li>
  
</ul>
<hr>
<ul class="nav nav-list">
  <li class="nav-header">Hats</li>
  
    <li><a href="/lost-woods-cap">Lost Woods Cap</a></li>
  
</ul>
<hr>
<ul class="nav nav-list">
  <li class="nav-header">Socks</li>
  
    <li><a href="/neely-ohara">Neely O'Hara</a></li>
  
    <li><a href="/traveling-socks-2">Traveling Socks</a></li>
  
    <li><a href="/lindsay-3">Lindsay</a></li>
  
    <li><a href="/the-sock-thief">The Sock Thief</a></li>
  
    <li><a href="/ms-wick">Ms. Wick</a></li>
  
    <li><a href="/lollipop-socks">Lollipop Socks</a></li>
  
    <li><a href="/socks-for-euni">Socks for Euni</a></li>
  
    <li><a href="/tobias-3">Tobias</a></li>
  
    <li><a href="/hey-jupiter">Hey Jupiter</a></li>
  
    <li><a href="/goneril--regan">Goneril & Regan</a></li>
  
    <li><a href="/coraline-2">Coraline</a></li>
  
    <li><a href="/temperance">Temperance</a></li>
  
    <li><a href="/maeby">Maeby</a></li>
  
</ul>
<hr>
<ul class="nav nav-list">
  <li class="nav-header">Cardigans</li>
  
    <li><a href="/snow-whites-lace">Snow White's Lace</a></li>
  
</ul>
<hr>
<ul class="nav nav-list">
  <li class="nav-header">Kids</li>
  
    <li><a href="/thistle-cap">Thistle Cap</a></li>
  
</ul>
<hr>
<ul class="nav nav-list">
  <li><a class="btn btn-small" role="button" data-toggle="modal" href="#modalPatternSupport">Pattern Help</a></li>
  <li>&nbsp;</li>
  <li><a href="#modalPurchaseInfo" role="button" class="btn btn-small" data-toggle="modal">Pattern Purchase FAQ</a></li>
  <li>&nbsp;</li>
  <li><a class="btn btn-small" role="button" data-toggle="modal" href="#modalFAQ">FAQ</a></li>
</ul>
<hr>
<ul class="nav nav-list">
  <li class="muted"><small>&copy; Liz Abinante</li>
  <li class="muted">feministy.com | 2007-2013</li>
  <li class="muted">Patterns are for non-commercial use only. You may not distribute or sell these patterns or items made using these patterns.</small></li>
</ul>
<hr>
<ul class="nav nav-list">
  <li><small><a href="mailto:liz@feministy.com">liz@feministy.com</a></small></li>
  <li><small><a href="http://twitter.com/feministy">Twitter @feministy</a></small></li>
</ul>

          </div>
          <div class="span10">
            <h1>
  Building a website with the Ravelry API
</h1>

<p class="text-success">
  A caveat about this tutorial: This isn't a "welcome to web development, this is how you do everything" type tutorial. I'm assuming that you know how to work with Ruby and are familiar with Github, the command line, APIs, JSON, HTML, CSS/Sass, and JavaScript. If any of those things are unfamiliar, you may not be able to follow all of this.
</p>

<hr>

<h3>Using the API: Two Options</h3>

<p>
  Anytime you want to work with data from an API, you have a few options.
</p>

<h4>Option 1: an API call for every page load</h4>

<p>
  If the API doesn't have rate limits, like the Ravelry API, you can make an API call with every page load. The upside to this is that your data will always be up to date and you don't have to worry about manual updates. The downsides to this are numerous:
</p>

<ul>
  <li>Your users control when your data is updated, not your server and not you</li>
  <li>It places a potentially unnecessarily large load on Ravelry's servers</li>
  <li>You're relying on Ravelry's servers to have just as good of an uptime as yours</li>
  <li>It's an extra thing that has to happen before users can view your content</li>
  <li>You have to build in safeguards to protect if the API has gone down or rejects your call</li>
  <li>If the API is updated or changed and you weren't paying attention, your entire site is probably screwed</li>
  <li>Your code becomes substantially more complex, and you likely need a server to run it, which increases hosting costs</li>
</ul>

<p>
  Hitting the API with every page load is a better option when your data is changing regularly. In the case of Ravelry at a, it's not changing regularly. It only changes when I change it.
</p>

<h4>Option 2: controlled API calls</h4>

<p>
  I, personally, think that hitting an API with every page load is a little silly when the data is mostly consistent. I'm not getting data that changes willy nilly. I'm getting *my* data from Ravelry. It's data that, for the most part, I control.
</p>

<p>
  The advantages to this are numerous:
</p>

<ul>
  <li>I can use a static site generator to serve up all my content, like <a href="http://middlemanapp.com/">Middleman</a> or <a href="http://www.jekyllrb.com">Jekyll</a> (I use Jekyll), instead of running something on a server and using a database</li>
  <li>It is way cheaper (potentially free) to host as a result of above ^</li>
  <li>I can write an automated script to fetch info from the API - it can run every X hours, or I can run it manually anytime I make updates to Ravelry</li>
  <li>I have time to adjust to API changes</li>
  <li>I control when my data is updated, not my user</li>
  <li>It doesn't add an extra load onto Ravelry's already very busy servers</li>
</ul>

<p>
  The only real downside is that I have to make a choice about how my data is updated. If I have a cron job that runs every X hours, I have to keep an eye on the API documentation and make sure nothing changes. If I decide to manually run the script that updates, I'm less susceptible to changes in the API, but I also have to run it manually.
</p>

<p>
  As far as I'm concerned, that is a sacrifice worth making. <strong>I went with Option 2.</strong>
</p>

<hr>

<h3>How I did it</h3>

<p>
  The things I used to build this site are:
</p>

<ul>
  <li>Github for version control</li>
  <li>Hosting for free by Github pages</li>
  <li>Jekyll for static site generation</li>
  <li>Ravelry API for data</li>
  <li>Several Ruby Gems to access the Ravelry API</li>
  <li>A hook to automatically build and deploy my site after each push to Github</li>
  <li>Twitter Bootstrap</li>
  <li>TypeKit for fonts</li>
</ul>

<p>
  All of the data comes from the pattern pages on Ravelry. You access this information through the API using the pattern ID from the Ravelry database. While you can search for the pattern by name using the API, the ID is much more efficient and you're guaranteed to get the correct pattern every time. The Ravelry API has no limits, so you can call on it for every page load if you wanted to and it wouldn't make too much of a difference. I don't do it that way: I make a series of batch calls to the API to get the initial data, and then I run updates periodically.
</p>

<h4>Step 1: getting the pattern ID</h4>
<p class="well well-small pull-right">
  If you have a lot of patterns, you may want to consider writing a
  <a href="http://docs.seleniumhq.org/" target="_blank">Selenium</a><br>
  driver that grabs the IDs and drops them into a yml file for you.
</p>

<p>
  Navigate to a pattern page in Ravelry and open up the JavaScript console. Type this in: <code>$$('.difficulty').first().id</code>.
</p>

<p>
  You should see something like this: <code>"pattern_419443_difficulty_score"</code>.
</p>

<p>
  You'll want to add that number (<code>419443</code>) to an array or whatever other mechanism you're using to process your API call.
</p>

<h4>Step 2: figuring out what to do with your data</h4>

<p>
  My site is rendered entirely by <a href="http://jekyllrb.com">Jekyll</a>. This means that all I had to do for each pattern was create a Markdown file with the necessary information in the YML front matter. I have a <i>ton</i> of information that I want to display, so my YML is pretty intense. Beneath the YML is the formatted pattern description from Ravelry.
</p>

<script src="https://gist.github.com/feministy/a8d2d8d82bdda63ec00e.js"></script>

<p>
  For every key in my YML ("title", "price", etc), there is a value assigned to it. Some of those values are arrays that I can iterate over, so I can store more information attached to one key. The big benefit of this is that I know that all of my images are in one place in the exact order they appear on Ravelry.
</p>

<p>
  Because I am using Jekyll, I also have a layout that uses these variables. It is pattern specific, so it doesn't confuse my blog posts or anything like that.
</p>

<script src="https://gist.github.com/feministy/2e63e85b4ed8be147914.js"></script>

<h4>Step 3: calling on the API</h4>

<p>
  I do not call on the Ravelry API with every page load. Not only does that potentially slow my page load, but it relies on the Ravelry API having up time that is at least as good as my server. While that's very likely, it's an extra moving part that I can take out of the equation for every page load.
</p>

<p>
  Ok, so I'm cheating a little here. The Ravelry API requires authentication with HTTP Basic Auth. You can use Ruby's Net:HTTP to complete these calls, but I had some trouble getting authorization to go through smoothly. Instead, I am using a <a href="https://github.com/taf2/curb" target="_blank">gem</a> that uses libcurl.
</p>

<script src="https://gist.github.com/feministy/0c75132aa8ff15dabb03.js"></script>

<p>
  For every key that I have in my YML front matter (above), there is a method in my API call that gets the data. Here are some samples of the different methods I have.
</p>

<script src="https://gist.github.com/feministy/e46cd0b933dafceef2d2.js"></script>

<p>
  I also have an entirely separate system for creating collection pages based on the information returned in the initial pattern API calls. Much of the content generated there is done in the same way: key/value pairs and static text/html/markdown.
</p>

<p>
  So that is how it is done. I am currently in the process of writing a script that will run once every 24hrs. It will make an API call, update the files, push them to Github, and upload them to my site so the changes are live. I can also manually trigger an update for all patterns, or one specific pattern, if I so desire.
 </p>

            <div id="modalPurchaseInfo" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times; Close</button>
    <h3>About pattern purchases</h3>
  </div>
<div class="modal-body">
  <p>Patterns are sold as downloadable PDF files through Ravelry, with payments processed by PayPal. You do not need an account to use either service.</p>
  <p>If you have a Ravelry account, I suggest logging in prior to purchasing so that patterns are added to your library.</p>
  </div>
</div>
<div id="modalPatternSupport" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times; Close</button>
    <h3>Get pattern help</h3>
  </div>
  <div class="modal-body">
    <p>Pattern support is provided free of charge for all of my patterns. We respond as quickly as possible, but sometimes it can take a day or two.</p>
    <h4><a href="https://feministy.zendesk.com/anonymous_requests/new">Submit a new help request through Zendesk.</a></h4>
    <p>You can also use Zendesk to report errors and ask non-technical questions.</p>
    <p class="muted">Alternatively, you can try the <a href="http://www.ravelry.com/groups/traveling-woman" target="_blank">Ravelry group</a>.</p>
  </div>
  <div class="modal-footer">
    <p class="muted">Support is only provided via Zendesk.</p>
  </div>
</div>
<div id="modalFAQ" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times; Close</button>
    <h3>FAQ</h3>
  </div>
  <div class="modal-body">
    <p class="alert alert-info">Can I teach a class using your knitting pattern?</p>
    <p>Teaching licensing is temporarily on hold and should resume in 2014.</p>
    <p class="alert alert-info">Can I sell items made using your knitting patterns for profit or charity?</p>
    <p>Not at this time.</p>
    <p class="alert alert-info">How do I order wholesale copies for my LYS?</p>
    <p>Pattern wholesaling is temporarily on hold and should resume in 2014.</p>
    <p class="alert alert-info">I found an error, how do I report it?</p>
    <p>Oh newts! Submit your error through <a href="https://feministy.zendesk.com/anonymous_requests/new" taret="_blank">Zendesk</a> and we will fix it.</p>
  </div>
  <div class="modal-footer">
    <p class="muted">Happy knitting!</p>
  </div>
</div>
          </div>
        </div>
      </div>

    <!-- Javascript for Bootstrap -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.js"></script>

    <!-- Fancy TypeKit fonts -->
    <script type="text/javascript" src="//use.typekit.net/pny8tfx.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/gist-embed/1.3/gist-embed.min.js"></script>
    </body>
</html>
